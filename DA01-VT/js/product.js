var listProduct = [
  {
    id: "SP01",
    img: "../imgs/sp/sp-kimtien-1.png",
    proName: "Cây Kim Tiền",
    price: "18100000",
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
  {
    id: "SP02",
    img: "../imgs/sp/sp-kimtien-2.png",
    proName: "Cây Kim Tiền 2",
    price: "18100000",
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
  {
    id: "SP03",
    img: "../imgs/sp/sp-truong-xuan.png",
    proName: "Cây Trường Xuân",
    price: "18100000",
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
  {
    id: "SP04",
    img: "../imgs/sp/sp-cay-canh-dep.png",
    proName: "Cây Cảnh Đẹp",
    price: "18100000",
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
  {
    id: "SP05",
    img: "../imgs/sp/sp-cay-canh-dep.png",
    proName: "Cây Cảnh Đẹp A",
    price: "18100000",
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
  {
    id: "SP06",
    img: "../imgs/sp/sp-truong-xuan.png",
    proName: "Cây Trường Xuân 2",
    price: "18100000",
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
  {
    id: "SP07",
    img: "../imgs/sp/sp-kimtien-1.png",
    proName: "Cây Kim Tiền X",
    price: "18100000",
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
  {
    id: "SP08",
    img: "../imgs/sp/sp-kimtien-2.png",
    proName: "Cây Kim Tiền Y",
    price: "18100000",
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
  {
    id: "SP09",
    img: "../imgs/sp/sp-kimtien-1.png",
    proName: "Cây Kim Tiền C",
    price: "18100000",
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
  {
    id: "SP010",
    img: "../imgs/sp/sp-kimtien-2.png",
    proName: "Cây Kim Tiền 2D",
    price: "18100000",
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
  {
    id: "SP011",
    img: "../imgs/sp/sp-truong-xuan.png",
    proName: "Cây Trường XuânE",
    price: "18100000",
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
  {
    id: "SP012",
    img: "../imgs/sp/sp-cay-canh-dep.png",
    proName: "Cây Cảnh Đẹp F",
    price: "18100000",
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
  {
    id: "SP013",
    img: "../imgs/sp/sp-cay-canh-dep.png",
    proName: "Cây Cảnh Đẹp A",
    price: "18100000",
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
  {
    id: "SP014",
    img: "../imgs/sp/sp-truong-xuan.png",
    proName: "Cây Trường Xuân 2 G",
    price: "18100000",
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
  {
    id: "SP015",
    img: "../imgs/sp/sp-kimtien-1.png",
    proName: "Cây Kim Tiền X",
    price: "18100000",
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
  {
    id: "SP016",
    img: "../imgs/sp/sp-kimtien-2.png",
    proName: "Cây Kim Tiền Y",
    price: "18100000",
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
  {
    id: "SP17",
    img: "../imgs/sp/sp-kimtien-2.png",
    proName: "Cây Kim Tiền Y",
    price: "18100000",
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
  {
    id: "SP18",
    img: "../imgs/sp/sp-kimtien-1.png",
    proName: "Cây Kim Tiền",
    price: "18100000",
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
  {
    id: "SP019",
    img: "../imgs/sp/sp-kimtien-2.png",
    proName: "Cây Kim Tiền 2",
    price: "18100000",
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
  {
    id: "SP020",
    img: "../imgs/sp/sp-truong-xuan.png",
    proName: "Cây Trường Xuân",
    price: "18100000",
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
  {
    id: "SP021",
    img: "../imgs/sp/sp-cay-canh-dep.png",
    proName: "Cây Cảnh Đẹp",
    price: "18100000",
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
  {
    id: "SP022",
    img: "../imgs/sp/sp-cay-canh-dep.png",
    proName: "Cây Cảnh Đẹp A",
    price: "18100000",
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
  {
    id: "SP023",
    img: "../imgs/sp/sp-truong-xuan.png",
    proName: "Cây Trường Xuân 2",
    price: "18100000",
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
  {
    id: "SP024",
    img: "../imgs/sp/sp-kimtien-1.png",
    proName: "Cây Kim Tiền X",
    price: "18100000",
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
  {
    id: "SP025",
    img: "../imgs/sp/sp-kimtien-2.png",
    proName: "Cây Kim Tiền Y",
    price: "18100000",
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
];
var listCartSet = [
  {
    id: "SP01",
    img: "../imgs/sp/sp-kimtien-1.png",
    proName: "Cây Kim Tiền",
    price: "18100000",
    quantity: 1,
    limit: 5,
    proDetail:
      "Cây Vạn Niên Thanh có ý nghĩa phong thủy tăng tài vận cho gia chủ. Người ta quan niệm, trồng vạn niên thanh trong nhà ngày tết mang đến sự sung túc",
  },
];


function setProductItem(obj, idHTML) {
  let item = `<div class="col-xl-3 col-sm-4 col-6 box-product">
      <div class="item-product">
        <div class="item-top">
          <div class="img-product">
            <img
              class="w-100"
              src="${obj.img}"
              alt="${obj.img}"
            />
          </div>
          <div class="bg-product-hover"></div>
          <div class="product-hover">
            <div class="product-description">
              <p class="product-detail cl-white">
              ${obj.proDetail}
              </p>
              <div
                class="btn-product d-flex justify-content-between"
              >
                <a href="#"
                  ><button class="btn btn-detail">
                    Chi Tiết
                  </button></a
                >
                <a href="#"
                  ><button class="btn btn-buy" data-id ="${
                    obj.id
                  }" data-bs-toggle="modal" data-bs-target="#staticBackdrop">Mua Ngay</button></a
                >
              </div>
            </div>
          </div>
        </div>
        <div class="title-bottom d-flex justify-center flex-swap">
          <a href="#" class="title-product-item align-center w-100"
            ><h4>${obj.proName}</h4></a
          >
          <span class="product-price cl-green align-center w-100"
            >${Intl.NumberFormat("en-US").format(obj.price)}</span
          >
        </div>
      </div>
    </div>`;
  $(idHTML).append(item);
}

function showListPro(list, idHTML) {
  let count = list.length;
  for (let i = 0; i < count; i++) {
    let obj = list[i];
    setProductItem(obj, idHTML);
  }
}

var pages = {
  pageIndex: 1,
  pageSize: 8,
  searchproName: "",
  maxPage: 0,
};

function getCountPage(list) {
  if (list.length % pages.pageSize == 0) return list.length / pages.pageSize;
  else {
    return Math.round(list.length / pages.pageSize + 0.5);
  }
}

function setViewNumberPages(list) {
  let countPage = getCountPage(list);
  $(".product-page-number").html(``);
  if (list.length % pages.pageSize == 0)
    countPage = list.length / pages.pageSize;
  else {
    countPage = Math.round(list.length / pages.pageSize + 0.5);
  }
  if (pages.pageIndex > 1) {
    $(".product-page-number").append(
      `<li class="page" value="pre-end"  onclick="changePageNumber('pre-end')"><span><i class="fa-solid fa-angles-left"></i></span></li>`
    );
    $(".product-page-number").append(
      `<li class="page" value="pre-page"  onclick="changePageNumber('pre-page')"><</li>`
    );
  }

  for (let page = 1; page <= countPage; page++) {
    var view = ` <li class="page" value="${page}"  onclick="changePageNumber('${page}')">${page}</li>`;
    $(".product-page-number").append(view);
  }

  if ((pages.pageIndex < countPage)) {
    $(".product-page-number").append(
      `<li class="page" value="next-page"  onclick="changePageNumber('next-page')">></li>`
    );
    $(".product-page-number").append(
      `<li class="page" value="next-end"  onclick="changePageNumber('next-end')"><span><i class="fa-solid fa-angles-right"></i></span></li>`
    );
  }
}

function getListView(list) {
  let count = list.length;
  var listTmp = [];
  // $('.product-page-conten .list-Products').html('');
  for (let i = 0; i < count; i++) {
    let obj = list[i];
    if (
      obj.proName.toLowerCase().includes(pages.searchproName.toLowerCase()) ||
      pages.searchproName == ""
    ) {
      listTmp.push(obj);
    }
  }
  return listTmp;
}

function searchItem() {
  pages.searchproName = $("#search").val();
  viewPages("#list-product-hot");
}

function checkPage(maxPage) {
  if (pages.pageIndex < 1) {
    pages.pageIndex = 1;
  } else if (pages.pageIndex > maxPage) {
    pages.pageIndex = maxPage;
  }
}
function proName(list, HTML) {
  pages.maxPage = getCountPage(list);
  checkPage(pages.maxPage);
  let count = list.length;
  $(HTML).html("");
  let start = (pages.pageIndex - 1) * pages.pageSize;
  let end = pages.pageIndex * pages.pageSize;
  for (i = start; i < end && i < count; i++) {
    let obj = list[i];
    setProductItem(obj, HTML);
  }
}

function changePageNumber(val) {
  if (val == "next-page") {
    pages.pageIndex++;
  } else if (val == "next-end") {
    pages.pageIndex = pages.maxPage;
  } else if (val == "pre-page") {
    pages.pageIndex--;
  } else if (val == "pre-end") {
    pages.pageIndex = 1;
  } else {
    pages.pageIndex = parseInt(val);
  }
  console.log(pages);
  viewPages("#list-product-hot");
}

function cssChoicePage(val) {
  $(".product-page-number .page.selected").removeClass(".selected");
  $(".product-page-number .page#page" + val).addClass("selected");
}

function choicePageSize(obj) {
  pages.pageSize = obj.value;
  viewPages("#list-product-hot");
}

function viewPages(HTML) {
  let listTemp = getListView(listProduct);
  proName(listTemp, HTML);
  setViewNumberPages(listTemp);
  cssChoicePage(pages.pageIndex);
}
// showListPro(listProduct, "#list-product-hot");
viewPages("#list-product-hot");
var listCart ;
function setLocal(key, value) {
    localStorage.removeItem(key);
    if (!key || !value) {return;}

    if (typeof value === "object") {
      value = JSON.stringify(value);
    }
    localStorage.setItem(key, value);
}


function getLocal(key){
    listCart = JSON.parse(localStorage.getItem(key));
}
// setLocal("listCarts",listCartSet);
getLocal("listCarts");

function setCartItem(obj) {
  let item = `<div class="item-cart" id ="item-cart-${obj.id}">
                  <div class="d-flex justify-between">
                      <div class="image-item-cart margin-auto">
                          <img class="w-100" src="${obj.img}" alt="">
                      </div>
                      <div class="title-item-cart margin-auto">
                          <h3>${obj.proName}</h3>
                      </div>
                      <div class="price-item-cart margin-auto">
                          <span id="cart-price-${obj.id}" data-price="${
    obj.price
  }">${Intl.NumberFormat("en-US").format(obj.price)}</span><span> VNĐ</span>
                      </div>
                      <div class="quantity-item-cart margin-auto">
                          <button type="button" class="btn-sub btn sub-${
                            obj.id
                          }" data-id="${obj.id}" onclick="subCart('${
    obj.id
  }')">-</button>
                              <span id="cart-quantity-${obj.id}">${
    obj.quantity
  }</span>
                          <button type="button" class="btn-add btn add-${
                            obj.id
                          }"
                          data-id="${obj.id}" onclick="addCart('${
    obj.id
  }')">+</button>
                      </div>
                      <div class="del-cart margin-auto">
                      <button  type="button" class="btn-del btn" id="del-cart-${
                        obj.id
                      }" data-id="${obj.id}" onclick="delCart('${
    obj.id
  }')"><span><i class="fa-solid fa-trash-can"></i></span></button>
                      </div>
                  </div>
              </div>`;
  $(".modal-body").append(item);
}
function showlistCart(list) {
  let count = list.length;
  for (let i = 0; i < count; i++) {
    let obj = list[i];
    setCartItem(obj);
  }
}
showlistCart(listCart);

function changeQuantity(id, phepTinh) {
  let count = listCart.length;
  for (let i = 0; i < count; i++) {
    if (id == listCart[i].id) {
      let quantity = listCart[i].quantity;
      if (phepTinh == "-") {
        quantity = parseInt(quantity) < 2 ? 1 : parseInt(quantity) - 1;
      } else {
        if (quantity < listCart[i].limit) {
          quantity = parseInt(quantity) + 1;
        }
      }
      listCart[i].quantity = quantity;
      setLocal("listCarts",listCart);
      return quantity;
    }
  } 
}

function subCart(id) {
  let quantity = changeQuantity(id, "-");
  $("#cart-quantity-"+id).text(quantity);
}

function addCart(id) {
  let quantity = changeQuantity(id, "+");
  $("#cart-quantity-"+id).text(quantity);

  // sumPrice(listCart);
}

function delCart(id) {
  listCart = listCart.filter((x) => x.id != id);
  $("#item-cart-" + id).remove();
  setLocal("listCarts",listCart);
  // sumPrice(listCart);
}
// $(".btn-sub").click(function () {
//   let id = $(this).attr("data-id");
//   let quantity = changeQuantity(id, "-");
//   $(this).siblings("span").text(quantity);
// });

function searchPro(list, id) {
  var count = list.length;
  for (let i = 0; i < count; i++) {
    let obj = list[i];
    if (id == obj.id) {
      return obj;
    }
  }
}

$(".btn-buy").click(function () {
  let id = $(this).attr("data-id");
  let objPro = searchPro(listProduct, id);
  let objCart = searchPro(listCart, id);
  if (objCart == null) {
    objPro.quantity = 1;
    objCart = objPro;
    setLocal("listCarts",listCart);
    setCartItem(objCart);
    listCart.push(objCart);
  } else {
    alert("Sản phẩm đã có trong giỏ hàng");
  }
});